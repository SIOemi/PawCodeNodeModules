{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\d896422\\\\Documents\\\\hello\\\\paw_code\\\\src\\\\appProvider.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport queryString from 'query-string';\nimport { useCookies } from 'react-cookie';\nimport { decode } from 'js-base64';\nimport * as moment from 'moment';\nimport unidades from './datos/unidades.json';\nimport { Typography, Box } from '@material-ui/core';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CONFIG = window.data;\n\nconst doLogin = () => window.location.href = CONFIG.autenticacionSIO + window.location.href;\n\nconst AppProvider = props => {\n  _s();\n\n  const [cookies, setCookie, removeCookie] = useCookies([\"token\"]);\n  var initial_state = {\n    vistaCompacta: true,\n    reloadListaDiscos: 0,\n    jefesDeTrabajosUnidad: {},\n    cargaFinalizada: false,\n    unidadDesc: \"\",\n    perfilDesc: \"\",\n    error: false,\n    shoswSidebar: true,\n    borrarCookies: () => {\n      window.location.href = \"/PAW\";\n    }\n  };\n  console.log(\"cooke\");\n  console.log(cookies); //guarda VALOR en la cookie NOMBRE por una hora\n\n  const guardarCookie = (nombre, valor) => {\n    setCookie(nombre, valor, {\n      path: \"/\",\n      maxAge: 3600\n    });\n    var newState = { ...initial_state\n    };\n    newState[nombre] = valor;\n    initial_state = newState;\n  };\n\n  React.useEffect(() => {\n    removeCookie('token'); // cookie con token que contienen usuario encriptado\n\n    let params = queryString.parse(window.location.search);\n\n    if (!state.cargaFinalizada && cookies.token && cookies.nombre && cookies.ci && cookies.unidadDesc && cookies.unidad && cookies.perfilDesc && cookies.operadorCMD && cookies.cargaFinalizada) {\n      console.log(\"cookies\");\n      console.log(cookies);\n      initial_state = { ...initial_state,\n        nombre: cookies.nombre,\n        ut: cookies.token,\n        ci: cookies.ci,\n        unidadDesc: cookies.unidadDesc,\n        unidad: cookies.unidad,\n        perfilDesc: cookies.perfilDesc,\n        operadorCMD: cookies.operadorCMD === \"true\",\n        responsableUnidad: cookies.responsableUnidad === \"true\",\n        usuarioConsulta: cookies.usuarioConsulta === \"true\",\n        cargaFinalizada: cookies.cargaFinalizada === \"true\",\n        error: cookies.error === \"true\"\n      };\n      setState(initial_state);\n    } else if (params.usuario == null) {\n      console.log(\"soy null\");\n      doLogin();\n    } else {\n      //Obtener usuario de URL y registrar cookie\n      let data = decode(params.usuario).split(\"|\", 4); // obtengo datos de la url\n      //control de antiguedad\n\n      let fechaServidor = data[3];\n      let fechaCliente = moment(Date.now()).format('YYYYMMDDHHmm');\n      if (fechaCliente - fechaServidor > 5) doLogin(); //Guardo el UT data[0]\n\n      guardarCookie(\"token\", data[0]); //Guardo el PERFIL  \n\n      let operadorCMD = data[1].includes(\"OPERADOR_DE_CMD\");\n      let responsableUnidad = data[1].includes(\"RESPONSABLE_DE_UNIDAD\");\n      let usuarioConsulta = data[1].includes(\"CONSULTA\") && !operadorCMD && !responsableUnidad;\n      let perfilDesc = operadorCMD ? \"Operador de CMD\" : responsableUnidad ? \"Resposanble de Unidad\" : usuarioConsulta ? \"Consulta\" : \"\";\n      guardarCookie(\"operadorCMD\", operadorCMD);\n      guardarCookie(\"responsableUnidad\", responsableUnidad);\n      guardarCookie(\"usuarioConsulta\", usuarioConsulta);\n      guardarCookie(\"perfilDesc\", perfilDesc); //Guardo la UNIDAD data[2]\n\n      let unidad = data[2];\n      console.log(\"estoy 118 en appprovider\");\n      console.log(unidad);\n      var unidadDesc = unidades.filter(u => u.id === unidad);\n      console.log(unidadDesc);\n      unidadDesc = !unidad || unidad === \"\" ? \"\" : unidadDesc.length > 0 ? unidadDesc[0].desc : \"Unidad desconocida\"; //Asigno la unidad 6300 por defecto para todos los operadores de CMD\n\n      if (operadorCMD && (!unidad || unidad == \"\")) {\n        unidad = 6300;\n        unidadDesc = \"Mantenimiento Montevideo\";\n      }\n\n      guardarCookie(\"unidad\", unidad);\n      guardarCookie(\"unidadDesc\", unidadDesc); //Guardo el NOMBRE y CI\n\n      let xmls = CONFIG.xmls_obtenerPersona(data[0]);\n      axios.post(CONFIG.servicetopaw, xmls, {\n        headers: {\n          'Content-Type': 'text/xml'\n        }\n      }).then(res => {\n        if (unidadDesc === \"\" && perfilDesc === \"\") throw 'Usuario sin unidad ni perfil asignado';else if (perfilDesc === \"\") throw 'Usuario sin perfil asignado';else if (unidadDesc === \"\") throw 'Usuario sin unidad asignada';\n        let token = res.data.split('<?xml version=\"1.0\"')[0];\n        let data = JSON.parse(token); //CI y NOMBRE\n\n        guardarCookie(\"ci\", data.NumeroDocumento);\n        guardarCookie(\"nombre\", data.Nombres.split(\" \")[0] + \" \" + data.PrimerApellido);\n        let nuevaURL = `${window.location.href}`.replace(/(\\?usuario=)[^#]*/g, \"\");\n        window.location.href = nuevaURL; //`${window.location.href}`;\n        //Craga Finalizada\n\n        guardarCookie(\"cargaFinalizada\", true);\n        guardarCookie(\"error\", unidadDesc === \"\" || perfilDesc === \"\");\n        setState(initial_state);\n      }).catch(error => {\n        alert(\"No se pudieron cargar los datos del usuario.\\n\" + error);\n      });\n    }\n  }, []);\n  const [state, setState] = React.useState(initial_state);\n\n  const mensajeError = state.error && /*#__PURE__*/_jsxDEV(Box, {\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    style: {\n      margin: 20,\n      marginTop: 60\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"img\", {\n      src: \"/PAW/assets/images/errorFace.png\",\n      style: {\n        width: 40,\n        height: 40\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 20\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        color: \"initial\",\n        children: \"\\\"Error!\\\"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"subtitle\",\n        color: \"initial\",\n        children: \"Comuniquese con la administraci\\xF3n.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 190,\n    columnNumber: 9\n  }, this);\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(AppContext.Provider, {\n      value: [state, setState],\n      children: state.cargaFinalizada ? props.children : /*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        flexDirection: \"row\",\n        alignItems: \"center\",\n        style: {\n          marginLeft: 20\n        },\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          color: \"initial\",\n          children: \"Abriendo PAW\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          alt: \"\",\n          src: \"/PAW/assets/images/wait.gif\",\n          width: \"100px\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 23\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 202,\n    columnNumber: 9\n  }, this);\n};\n\n_s(AppProvider, \"mgeG7XimuR6QDFxjMJn8ZJGwdI4=\", false, function () {\n  return [useCookies];\n});\n\n_c = AppProvider;\nexport default AppProvider;\nexport const AppContext = /*#__PURE__*/React.createContext();\n\nvar _c;\n\n$RefreshReg$(_c, \"AppProvider\");","map":{"version":3,"sources":["C:/Users/d896422/Documents/hello/paw_code/src/appProvider.js"],"names":["React","queryString","useCookies","decode","moment","unidades","Typography","Box","axios","CONFIG","window","data","doLogin","location","href","autenticacionSIO","AppProvider","props","cookies","setCookie","removeCookie","initial_state","vistaCompacta","reloadListaDiscos","jefesDeTrabajosUnidad","cargaFinalizada","unidadDesc","perfilDesc","error","shoswSidebar","borrarCookies","console","log","guardarCookie","nombre","valor","path","maxAge","newState","useEffect","params","parse","search","state","token","ci","unidad","operadorCMD","ut","responsableUnidad","usuarioConsulta","setState","usuario","split","fechaServidor","fechaCliente","Date","now","format","includes","filter","u","id","length","desc","xmls","xmls_obtenerPersona","post","servicetopaw","headers","then","res","JSON","NumeroDocumento","Nombres","PrimerApellido","nuevaURL","replace","catch","alert","useState","mensajeError","margin","marginTop","width","height","children","marginLeft","AppContext","createContext"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport queryString from 'query-string';\r\nimport { useCookies } from 'react-cookie';\r\nimport { decode } from 'js-base64';\r\nimport * as moment from 'moment';\r\nimport unidades from './datos/unidades.json';\r\nimport { Typography, Box } from '@material-ui/core';\r\n\r\nimport axios from 'axios';\r\n\r\nconst CONFIG = window.data;\r\n\r\nconst doLogin = () =>\r\n    window.location.href = CONFIG.autenticacionSIO + window.location.href;\r\n\r\n\r\nconst AppProvider = (props) => {\r\n\r\n    \r\n    const [cookies, setCookie, removeCookie] = useCookies([\"token\"]);\r\n\r\n\r\n\r\n    var initial_state = {\r\n        vistaCompacta: true,\r\n        reloadListaDiscos: 0,\r\n        jefesDeTrabajosUnidad: {},\r\n        cargaFinalizada: false,\r\n        unidadDesc: \"\",\r\n        perfilDesc: \"\",\r\n        error: false,\r\n        shoswSidebar: true,\r\n        borrarCookies: () => {\r\n            window.location.href = \"/PAW\";\r\n        }\r\n    }\r\n\r\n  console.log(\"cooke\")\r\nconsole.log(cookies);\r\n\r\n    //guarda VALOR en la cookie NOMBRE por una hora\r\n    const guardarCookie = (nombre, valor) => {\r\n        setCookie(nombre, valor, { path: \"/\", maxAge: 3600 });\r\n        var newState = { ...initial_state };\r\n        newState[nombre] = valor;\r\n        initial_state = newState;\r\n    }\r\n\r\n\r\n    React.useEffect(() => {\r\n        removeCookie('token');\r\n        // cookie con token que contienen usuario encriptado\r\n        let params = queryString.parse(window.location.search);\r\n        if (\r\n            !state.cargaFinalizada && cookies.token && cookies.nombre && cookies.ci && cookies.unidadDesc &&\r\n            cookies.unidad && cookies.perfilDesc && cookies.operadorCMD && cookies.cargaFinalizada\r\n        ) {\r\n\r\n            console.log(\"cookies\")\r\n            console.log(cookies)\r\n            initial_state = {\r\n                ...initial_state,\r\n                nombre: cookies.nombre,\r\n                ut: cookies.token,\r\n                ci: cookies.ci,\r\n                unidadDesc: cookies.unidadDesc,\r\n                unidad: cookies.unidad,\r\n                perfilDesc: cookies.perfilDesc,\r\n                operadorCMD: cookies.operadorCMD === \"true\",\r\n                responsableUnidad: cookies.responsableUnidad === \"true\",\r\n                usuarioConsulta: cookies.usuarioConsulta === \"true\",\r\n                cargaFinalizada: cookies.cargaFinalizada === \"true\",\r\n                error: cookies.error === \"true\"\r\n            }\r\n\r\n            setState(initial_state);\r\n        }\r\n        else if (\r\n\r\n            params.usuario == null\r\n        ) {\r\n            console.log(\"soy null\")\r\n            doLogin();\r\n        }\r\n        else { //Obtener usuario de URL y registrar cookie\r\n\r\n\r\n            let data = decode(params.usuario).split(\"|\", 4); // obtengo datos de la url\r\n\r\n            //control de antiguedad\r\n            let fechaServidor = data[3];\r\n            let fechaCliente = (moment(Date.now())).format('YYYYMMDDHHmm');\r\n            if (fechaCliente - fechaServidor > 5) doLogin();\r\n\r\n            //Guardo el UT data[0]\r\n            guardarCookie(\"token\", data[0]);\r\n\r\n            //Guardo el PERFIL  \r\n            let operadorCMD = data[1].includes(\"OPERADOR_DE_CMD\");\r\n            let responsableUnidad = data[1].includes(\"RESPONSABLE_DE_UNIDAD\");\r\n            let usuarioConsulta = data[1].includes(\"CONSULTA\") && !operadorCMD && !responsableUnidad;\r\n\r\n            let perfilDesc = operadorCMD\r\n                ? \"Operador de CMD\"\r\n                : responsableUnidad\r\n                    ? \"Resposanble de Unidad\"\r\n                    : usuarioConsulta\r\n                        ? \"Consulta\"\r\n                        : \"\";\r\n\r\n\r\n            guardarCookie(\"operadorCMD\", operadorCMD);\r\n            guardarCookie(\"responsableUnidad\", responsableUnidad);\r\n            guardarCookie(\"usuarioConsulta\", usuarioConsulta);\r\n            guardarCookie(\"perfilDesc\", perfilDesc);\r\n\r\n\r\n\r\n            //Guardo la UNIDAD data[2]\r\n\r\n            let unidad = data[2];\r\n            console.log(\"estoy 118 en appprovider\")\r\n            console.log(unidad);\r\n            var unidadDesc = unidades.filter(u => u.id === unidad);\r\n            console.log(unidadDesc);\r\n            unidadDesc = !unidad || unidad === \"\"\r\n                ? \"\"\r\n                : unidadDesc.length > 0\r\n                    ? unidadDesc[0].desc\r\n                    : \"Unidad desconocida\";\r\n\r\n            //Asigno la unidad 6300 por defecto para todos los operadores de CMD\r\n            if (operadorCMD && (!unidad || unidad == \"\")) {\r\n                unidad = 6300;\r\n                unidadDesc = \"Mantenimiento Montevideo\"\r\n            }\r\n\r\n            guardarCookie(\"unidad\", unidad);\r\n            guardarCookie(\"unidadDesc\", unidadDesc);\r\n\r\n\r\n\r\n\r\n\r\n            //Guardo el NOMBRE y CI\r\n            let xmls = CONFIG.xmls_obtenerPersona(data[0]);\r\n\r\n            axios.post(CONFIG.servicetopaw, xmls, { headers: { 'Content-Type': 'text/xml' } })\r\n                .then(res => {\r\n\r\n\r\n                    if (unidadDesc === \"\" && perfilDesc === \"\")\r\n                        throw 'Usuario sin unidad ni perfil asignado';\r\n                    else if (perfilDesc === \"\")\r\n                        throw 'Usuario sin perfil asignado';\r\n                    else if (unidadDesc === \"\")\r\n                        throw 'Usuario sin unidad asignada';\r\n\r\n                    let token = res.data.split('<?xml version=\"1.0\"')[0];\r\n                    let data = JSON.parse(token);\r\n\r\n                    //CI y NOMBRE\r\n                    guardarCookie(\"ci\", data.NumeroDocumento);\r\n                    guardarCookie(\"nombre\", data.Nombres.split(\" \")[0] + \" \" + data.PrimerApellido);\r\n\r\n                    let nuevaURL = `${window.location.href}`.replace(/(\\?usuario=)[^#]*/g, \"\");\r\n                    window.location.href = nuevaURL; //`${window.location.href}`;\r\n\r\n                    //Craga Finalizada\r\n                    guardarCookie(\"cargaFinalizada\", true);\r\n                    guardarCookie(\"error\", unidadDesc === \"\" || perfilDesc === \"\");\r\n                    setState(initial_state);\r\n\r\n\r\n                })\r\n                .catch(error => { alert(\"No se pudieron cargar los datos del usuario.\\n\" + error); });\r\n\r\n        }\r\n\r\n\r\n\r\n    }, []);\r\n\r\n\r\n    const [state, setState] = React.useState(initial_state);\r\n\r\n\r\n\r\n    const mensajeError = state.error && (\r\n        <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\" style={{ margin: 20, marginTop: 60 }}>\r\n            <img src=\"/PAW/assets/images/errorFace.png\" style={{ width: 40, height: 40 }} />\r\n            <div style={{ marginTop: 20 }}>\r\n                <Typography variant=\"h6\" color=\"initial\">\"Error!\"</Typography>\r\n                <Typography variant=\"subtitle\" color=\"initial\">Comuniquese con la administraci√≥n.</Typography>\r\n            </div>\r\n        </Box>\r\n    )\r\n\r\n\r\n\r\n    return (\r\n        <div>\r\n            <AppContext.Provider value={[state, setState]}>\r\n\r\n                {state.cargaFinalizada\r\n                    ? props.children\r\n                    : <Box display=\"flex\" flexDirection=\"row\" alignItems=\"center\" style={{ marginLeft: 20 }}>\r\n                        <Typography variant=\"subtitle1\" color=\"initial\">Abriendo PAW</Typography>\r\n                        <img alt=\"\" src=\"/PAW/assets/images/wait.gif\" width=\"100px\" />\r\n                    </Box>\r\n                }\r\n            </AppContext.Provider>\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport default AppProvider;\r\nexport const AppContext = React.createContext();"]},"metadata":{},"sourceType":"module"}