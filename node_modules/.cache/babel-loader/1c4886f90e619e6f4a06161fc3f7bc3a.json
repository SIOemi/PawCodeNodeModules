{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\d896422\\\\Documents\\\\hello\\\\paw_code\\\\src\\\\appProvider.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport queryString from 'query-string';\nimport { useCookies } from 'react-cookie';\nimport { decode } from 'js-base64';\nimport * as moment from 'moment';\nimport unidades from './datos/unidades.json';\nimport { Typography, Box } from '@material-ui/core';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CONFIG = window.data;\n\nconst doLogin = () => window.location.href = CONFIG.autenticacionSIO + window.location.href;\n\nconst AppProvider = props => {\n  _s();\n\n  const [cookies, setCookie, removeCookie] = useCookies([\"token\"]);\n  cookies.unidadDesc = \"Explotación Durazno\";\n  cookies.unidad = 3;\n  cookies.perfilDesc = \"Jefe de Trabajos\";\n  var initial_state = {\n    vistaCompacta: true,\n    reloadListaDiscos: 0,\n    jefesDeTrabajosUnidad: {},\n    cargaFinalizada: false,\n    unidadDesc: \"\",\n    perfilDesc: \"\",\n    error: false,\n    shoswSidebar: true,\n    borrarCookies: () => {\n      window.location.href = \"/PAW\";\n    }\n  }; //guarda VALOR en la cookie NOMBRE por una hora\n\n  const guardarCookie = (nombre, valor) => {\n    setCookie(nombre, valor, {\n      path: \"/\",\n      maxAge: 3600\n    });\n    var newState = { ...initial_state\n    };\n    newState[nombre] = valor;\n    initial_state = newState;\n  };\n\n  React.useEffect(() => {\n    removeCookie('token'); //cookie con token que contienen usuario encriptado\n\n    let params = queryString.parse(window.location.search);\n\n    if (!state.cargaFinalizada && cookies.token && cookies.nombre && cookies.ci && cookies.unidadDesc && cookies.unidad && cookies.perfilDesc && cookies.operadorCMD && cookies.cargaFinalizada) {\n      initial_state = { ...initial_state,\n        nombre: cookies.nombre,\n        ut: cookies.token,\n        ci: cookies.ci,\n        unidadDesc: cookies.unidadDesc,\n        unidad: cookies.unidad,\n        perfilDesc: cookies.perfilDesc,\n        operadorCMD: cookies.operadorCMD === \"true\",\n        responsableUnidad: cookies.responsableUnidad === \"true\",\n        usuarioConsulta: cookies.usuarioConsulta === \"true\",\n        cargaFinalizada: cookies.cargaFinalizada === \"true\",\n        error: cookies.error === \"true\"\n      };\n      setState(initial_state);\n    } else if (params.usuario == null) {\n      doLogin();\n    } else {\n      //Obtener usuario de URL y registrar cookie\n      let data = decode(params.usuario).split(\"|\", 4); // obtengo datos de la url\n      //control de antiguedad\n\n      let fechaServidor = data[3];\n      let fechaCliente = moment(Date.now()).format('YYYYMMDDHHmm');\n      if (fechaCliente - fechaServidor > 5) doLogin(); //Guardo el UT data[0]\n\n      guardarCookie(\"token\", data[0]); //Guardo el PERFIL  \n\n      let operadorCMD = data[1].includes(\"OPERADOR_DE_CMD\");\n      let responsableUnidad = data[1].includes(\"RESPONSABLE_DE_UNIDAD\");\n      let usuarioConsulta = data[1].includes(\"CONSULTA\") && !operadorCMD && !responsableUnidad;\n      let perfilDesc = operadorCMD ? \"Operador de CMD\" : responsableUnidad ? \"Resposanble de Unidad\" : usuarioConsulta ? \"Consulta\" : \"\";\n      guardarCookie(\"operadorCMD\", operadorCMD);\n      guardarCookie(\"responsableUnidad\", responsableUnidad);\n      guardarCookie(\"usuarioConsulta\", usuarioConsulta);\n      guardarCookie(\"perfilDesc\", perfilDesc); //Guardo la UNIDAD data[2]\n\n      let unidad = data[2];\n      var unidadDesc = unidades.filter(u => u.id == unidad);\n      unidadDesc = !unidad || unidad == \"\" ? \"\" : unidadDesc.length > 0 ? unidadDesc[0].desc : \"Unidad desconocida\"; //Asigno la unidad 6300 por defecto para todos los operadores de CMD\n\n      if (operadorCMD && (!unidad || unidad == \"\")) {\n        unidad = 6300;\n        unidadDesc = \"Mantenimiento Montevideo\";\n      }\n\n      guardarCookie(\"unidad\", unidad);\n      guardarCookie(\"unidadDesc\", unidadDesc); //Guardo el NOMBRE y CI\n\n      let xmls = CONFIG.xmls_obtenerPersona(data[0]);\n      axios.post(CONFIG.servicetopaw, xmls, {\n        headers: {\n          'Content-Type': 'text/xml'\n        }\n      }).then(res => {\n        if (unidadDesc === \"\" && perfilDesc === \"\") throw 'Usuario sin unidad ni perfil asignado';else if (perfilDesc === \"\") throw 'Usuario sin perfil asignado';else if (unidadDesc === \"\") throw 'Usuario sin unidad asignada';\n        let token = res.data.split('<?xml version=\"1.0\"')[0];\n        let data = JSON.parse(token); //CI y NOMBRE\n\n        guardarCookie(\"ci\", data.NumeroDocumento);\n        guardarCookie(\"nombre\", data.Nombres.split(\" \")[0] + \" \" + data.PrimerApellido);\n        let nuevaURL = `${window.location.href}`.replace(/(\\?usuario=)[^#]*/g, \"\");\n        window.location.href = nuevaURL; //`${window.location.href}`;\n        //Craga Finalizada\n\n        guardarCookie(\"cargaFinalizada\", true);\n        guardarCookie(\"error\", unidadDesc === \"\" || perfilDesc === \"\");\n        setState(initial_state);\n      }).catch(error => {\n        alert(\"No se pudieron cargar los datos del usuario.\\n\" + error);\n      });\n    }\n  }, []);\n  const [state, setState] = React.useState(initial_state);\n\n  const mensajeError = state.error && /*#__PURE__*/_jsxDEV(Box, {\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    style: {\n      margin: 20,\n      marginTop: 60\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"img\", {\n      src: \"/PAW/assets/images/errorFace.png\",\n      style: {\n        width: 40,\n        height: 40\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 20\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        color: \"initial\",\n        children: \"\\\"Error!\\\"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"subtitle\",\n        color: \"initial\",\n        children: \"Comuniquese con la administraci\\xF3n.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 181,\n    columnNumber: 13\n  }, this);\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(AppContext.Provider, {\n      value: [state, setState],\n      children: state.cargaFinalizada ? props.children : /*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        flexDirection: \"row\",\n        alignItems: \"center\",\n        style: {\n          marginLeft: 20\n        },\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          color: \"initial\",\n          children: \"Abriendo PAW\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          alt: \"\",\n          src: \"/PAW/assets/images/wait.gif\",\n          width: \"100px\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 23\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 193,\n    columnNumber: 9\n  }, this);\n};\n\n_s(AppProvider, \"mgeG7XimuR6QDFxjMJn8ZJGwdI4=\", false, function () {\n  return [useCookies];\n});\n\n_c = AppProvider;\nexport default AppProvider;\nexport const AppContext = /*#__PURE__*/React.createContext();\n\nvar _c;\n\n$RefreshReg$(_c, \"AppProvider\");","map":{"version":3,"sources":["C:/Users/d896422/Documents/hello/paw_code/src/appProvider.js"],"names":["React","queryString","useCookies","decode","moment","unidades","Typography","Box","axios","CONFIG","window","data","doLogin","location","href","autenticacionSIO","AppProvider","props","cookies","setCookie","removeCookie","unidadDesc","unidad","perfilDesc","initial_state","vistaCompacta","reloadListaDiscos","jefesDeTrabajosUnidad","cargaFinalizada","error","shoswSidebar","borrarCookies","guardarCookie","nombre","valor","path","maxAge","newState","useEffect","params","parse","search","state","token","ci","operadorCMD","ut","responsableUnidad","usuarioConsulta","setState","usuario","split","fechaServidor","fechaCliente","Date","now","format","includes","filter","u","id","length","desc","xmls","xmls_obtenerPersona","post","servicetopaw","headers","then","res","JSON","NumeroDocumento","Nombres","PrimerApellido","nuevaURL","replace","catch","alert","useState","mensajeError","margin","marginTop","width","height","children","marginLeft","AppContext","createContext"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport queryString from 'query-string';\r\nimport { useCookies } from 'react-cookie';\r\nimport { decode } from 'js-base64';\r\nimport * as moment from 'moment';\r\nimport unidades from './datos/unidades.json';\r\nimport {Typography, Box} from '@material-ui/core';\r\n\r\nimport axios from 'axios';\r\n\r\nconst CONFIG = window.data;\r\n\r\nconst doLogin = () =>\r\n     window.location.href = CONFIG.autenticacionSIO + window.location.href;\r\n\r\n\r\nconst AppProvider = (props) => {\r\n\r\n    const [cookies, setCookie, removeCookie] = useCookies([\"token\"]);\r\n\r\n    cookies.unidadDesc = \"Explotación Durazno\";\r\n    cookies.unidad = 3;\r\n    cookies.perfilDesc =\"Jefe de Trabajos\";\r\n    var initial_state=  {\r\n        vistaCompacta: true,\r\n        reloadListaDiscos: 0,\r\n        jefesDeTrabajosUnidad: {},\r\n        cargaFinalizada: false,\r\n        unidadDesc: \"\",\r\n        perfilDesc: \"\",\r\n        error: false,\r\n        shoswSidebar: true,\r\n        borrarCookies: ()=>{ \r\n            window.location.href = \"/PAW\";\r\n        }\r\n    }\r\n\r\n    //guarda VALOR en la cookie NOMBRE por una hora\r\n    const guardarCookie = (nombre, valor) => {\r\n        setCookie(nombre, valor, { path: \"/\", maxAge: 3600});\r\n        var newState = {...initial_state};\r\n        newState[nombre]=valor;\r\n        initial_state = newState;\r\n    }\r\n\r\n \r\n    React.useEffect(() => {\r\n\r\n       \r\n        removeCookie('token');\r\n\r\n        //cookie con token que contienen usuario encriptado\r\n        let params = queryString.parse(window.location.search);\r\n        if (!state.cargaFinalizada && cookies.token && cookies.nombre && cookies.ci && cookies.unidadDesc && \r\n            cookies.unidad && cookies.perfilDesc && cookies.operadorCMD && cookies.cargaFinalizada) {\r\n\r\n                initial_state = {\r\n                    ...initial_state,\r\n                    nombre: cookies.nombre,\r\n                    ut: cookies.token,\r\n                    ci: cookies.ci,\r\n                    unidadDesc: cookies.unidadDesc,\r\n                    unidad: cookies.unidad,\r\n                    perfilDesc: cookies.perfilDesc,\r\n                    operadorCMD: cookies.operadorCMD===\"true\",\r\n                    responsableUnidad: cookies.responsableUnidad===\"true\",\r\n                    usuarioConsulta: cookies.usuarioConsulta===\"true\",\r\n                    cargaFinalizada: cookies.cargaFinalizada===\"true\",\r\n                    error: cookies.error===\"true\"\r\n                }\r\n           \r\n                setState(initial_state);\r\n        } \r\n        else if (params.usuario == null) {\r\n            doLogin();\r\n        }\r\n        else { //Obtener usuario de URL y registrar cookie\r\n    \r\n\r\n            let data = decode(params.usuario).split(\"|\", 4); // obtengo datos de la url\r\n            \r\n            //control de antiguedad\r\n            let fechaServidor = data[3];\r\n            let fechaCliente = (moment(Date.now())).format('YYYYMMDDHHmm');\r\n            if (fechaCliente - fechaServidor > 5) doLogin();\r\n            \r\n            //Guardo el UT data[0]\r\n            guardarCookie(\"token\",data[0]);\r\n\r\n            //Guardo el PERFIL  \r\n            let operadorCMD =  data[1].includes(\"OPERADOR_DE_CMD\"); \r\n            let responsableUnidad = data[1].includes(\"RESPONSABLE_DE_UNIDAD\"); \r\n            let usuarioConsulta = data[1].includes(\"CONSULTA\") && !operadorCMD && !responsableUnidad; \r\n\r\n            let perfilDesc = operadorCMD \r\n                        ? \"Operador de CMD\" \r\n                        : responsableUnidad \r\n                            ? \"Resposanble de Unidad\" \r\n                            : usuarioConsulta\r\n                                ? \"Consulta\"\r\n                                : \"\";\r\n            \r\n            \r\n            guardarCookie(\"operadorCMD\",operadorCMD);\r\n            guardarCookie(\"responsableUnidad\",responsableUnidad);\r\n            guardarCookie(\"usuarioConsulta\",usuarioConsulta);\r\n            guardarCookie(\"perfilDesc\",perfilDesc);\r\n\r\n     \r\n            \r\n            //Guardo la UNIDAD data[2]\r\n\r\n            let unidad = data[2];\r\n\r\n            var unidadDesc = unidades.filter(u => u.id == unidad);\r\n            \r\n            unidadDesc = !unidad || unidad==\"\"\r\n                            ? \"\"\r\n                            : unidadDesc.length > 0 \r\n                                ? unidadDesc[0].desc \r\n                                : \"Unidad desconocida\";\r\n\r\n            //Asigno la unidad 6300 por defecto para todos los operadores de CMD\r\n            if (operadorCMD && (!unidad || unidad==\"\")) {\r\n                unidad = 6300; \r\n                unidadDesc = \"Mantenimiento Montevideo\"\r\n            }\r\n            \r\n            guardarCookie(\"unidad\", unidad);\r\n            guardarCookie(\"unidadDesc\", unidadDesc);\r\n            \r\n          \r\n            \r\n            \r\n\r\n            //Guardo el NOMBRE y CI\r\n            let xmls = CONFIG.xmls_obtenerPersona(data[0]);\r\n\r\n            axios.post(CONFIG.servicetopaw ,xmls,{headers: {'Content-Type': 'text/xml'}})\r\n            .then(res=>{\r\n\r\n               \r\n                if (unidadDesc === \"\" && perfilDesc === \"\")  \r\n                    throw 'Usuario sin unidad ni perfil asignado';\r\n                else if (perfilDesc === \"\")  \r\n                    throw 'Usuario sin perfil asignado';\r\n                else if (unidadDesc === \"\")  \r\n                    throw 'Usuario sin unidad asignada';\r\n\r\n                let token = res.data.split('<?xml version=\"1.0\"')[0];\r\n                let data = JSON.parse(token);\r\n        \r\n                //CI y NOMBRE\r\n                guardarCookie(\"ci\",data.NumeroDocumento);\r\n                guardarCookie(\"nombre\",data.Nombres.split(\" \")[0] + \" \" + data.PrimerApellido);\r\n              \r\n                let nuevaURL = `${window.location.href}`.replace(/(\\?usuario=)[^#]*/g,\"\");\r\n                window.location.href =nuevaURL; //`${window.location.href}`;\r\n                \r\n                //Craga Finalizada\r\n                guardarCookie(\"cargaFinalizada\",true);  \r\n                guardarCookie(\"error\", unidadDesc===\"\" || perfilDesc===\"\");\r\n                setState(initial_state);\r\n\r\n                \r\n            })\r\n            .catch(error=>{ alert(\"No se pudieron cargar los datos del usuario.\\n\" + error);});   \r\n    \r\n        }\r\n\r\n    \r\n\r\n      }, []);\r\n\r\n    \r\n    const [state, setState] = React.useState(initial_state);\r\n\r\n    \r\n  \r\n    const mensajeError = state.error && (\r\n            <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\" style={{margin: 20, marginTop: 60}}>\r\n                <img src=\"/PAW/assets/images/errorFace.png\" style={{width: 40, height: 40}} />               \r\n                <div style={{marginTop: 20}}>\r\n                    <Typography variant=\"h6\" color=\"initial\">\"Error!\"</Typography>\r\n                    <Typography variant=\"subtitle\" color=\"initial\">Comuniquese con la administración.</Typography>\r\n                </div>\r\n            </Box>\r\n        )\r\n\r\n      \r\n  \r\n    return (\r\n        <div>\r\n            <AppContext.Provider value={[state, setState]}>\r\n\r\n                {state.cargaFinalizada \r\n                    ? props.children\r\n                    : <Box display=\"flex\" flexDirection=\"row\" alignItems=\"center\" style={{marginLeft: 20}}>\r\n                        <Typography variant=\"subtitle1\" color=\"initial\">Abriendo PAW</Typography>\r\n                        <img alt=\"\" src=\"/PAW/assets/images/wait.gif\" width=\"100px\" />\r\n                    </Box>\r\n                }\r\n            </AppContext.Provider>\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport default AppProvider;\r\nexport const AppContext = React.createContext();"]},"metadata":{},"sourceType":"module"}